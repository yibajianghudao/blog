---
title: SSH
date: 2025-06-07 13:11:57
tags:
description: SSH远程连接
---

# 远程连接

远程连接一般使用两个工具,ssh和telnet,其中telnet使用非加密通道,并不安全.
##　SSH

Secure Shell,简称SSH,是一种加密的网络传输协议,可以在不安全的网络中为网络服务提供安全的传输环境.最常见的用途是远程登录系统命令行界面和远程执行命令.

### SSH密钥

对于使用公钥加密的SSH服务器,SSH密钥可以作为证明身份的方法.基于密钥的认证不易遭受暴力破解攻击.
SSH密钥都是成对生成的,一个是公钥,一个是私钥,私钥必须安全保管,且不应在网络中传输.公钥可以自由的共享(向你想连接的任何SSH服务器).

> 如果一个 SSH 服务器在文件中存有您的公钥，并收到了您的连接请求，就会使用您的公钥构建一个质询问题并发送给您。这一质询问题是一条加密信息，必须得到正确应答，服务器才能允许您访问。这条编码信息特别安全是在于，只有私钥持有者才能理解它。公钥可以用来加密信息，但不能用来解密同一条信息。只有您，私钥的持有者，能够正确理解这一质询问题并产生合适的应答。
>
> 这一[质询-应答](https://en.wikipedia.org/wiki/Challenge-response_authentication)过程发生在后台，对用户不可见。只要您持有私钥（一般存放在 `~/.ssh/` 目录下），您的 SSH 客户端就应当能够向服务器回复正确的应答。
>
> 私钥是受保护的秘密，因此建议以加密形式将其存储在磁盘上。当需要被加密的私钥时，为了解密它，需要先输入密码。虽然这在表面上可能像是您在向 SSH 服务器提供登录密码，但该密码只用于解密本地系统上的私钥。**该密码并未通过网络传输**。

使用`ssh-keygen`生成密钥.

可以使用`ssh-copy-id -i ~/.ssh/id_ed25519.pub -p 22 username@remote-server.org`上传公钥到远程服务器.

### SSH代理

> 如果您的私钥使用密码短语来加密了的话，每一次试图连接到使用公钥认证的 SSH 服务器的时候，您都必须输入密码短语。每次唤起 `ssh` 或 `scp` 时都需要密码短语来解密您的私钥以便认证能够继续。
>
> 而 SSH 代理程序能够将您的已解密的私钥缓存起来，并代表您将其提供给 SSH 客户端。这样子，您就只需要将私钥加入 SSH 代理缓存的时候输入一次密码短语就可以了。在经常使用 SSH 连接时，将会提供不少便利。
>
> SSH 代理一般会设置成在登录会话的时候自动启动，并在整个会话中保持运行。有多种代理、前端及配置都能够达成这一效果。本节概述了多种不同的解决方案，能够适应以满足您的特定需求。

`ssh-agent` 是 OpenSSH 自带的默认代理。

`ssh-agent` 运行时会自动 fork 到后台，然后打印出其所需的环境变量，例如：

```
$ ssh-agent
SSH_AUTH_SOCK=/tmp/ssh-vEGjCM2147/agent.2147; export SSH_AUTH_SOCK;
SSH_AGENT_PID=2148; export SSH_AGENT_PID;
echo Agent pid 2148;
```

要使用这些环境变量，请使用 `eval` 命令来运行它。如果使用的是 `fish` shell，需要转而使用 `ssh-agent -c`。

```
$ eval $(ssh-agent)
Agent pid 2157
```

`ssh-agent` 运行起来之后，您还需要将您的私钥加入它的缓存。

```
$ ssh-add ~/.ssh/id_ed25519
Enter passphrase for /home/user/.ssh/id_ed25519:
Identity added: /home/user/.ssh/id_ed25519 (/home/user/.ssh/id_ed25519)
```

如果您的私钥已加密，`ssh-add` 会提示您输入密码短语。一旦您的私钥被成功添加到代理，您不需要再输入密码短语就能够建立 SSH 连接了。

### SSH命令

远程连接:

```bash
ssh -p 2211 root@140.206.185.170
```

远程发送命令:

```bash
ssh 10.0.0.7 'touch test.txt'
```



## SCP

```bash 
scp -P 2222 test.txt 10.0.0.41:/opt/
```

