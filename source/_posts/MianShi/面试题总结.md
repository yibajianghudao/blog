# 一、网络

**（1）TCP和UDP的区别？**

TCP是面向连接、可靠的传输协议，在传输数据前需建立一条点到点的连接，也就是TCP的三次握手过程。UDP是无连接、不可靠的传输协议。所以TCP专注于数据的可靠性传输，应用在可靠性高传输的场景，例如HTTP/HTTPS、FTP等服务中，而UDP更专注于数据的快速传输，应用在对实时性要求高的场景，例如直播、视频会议等等。

**（2）TCP的三次握手过程？**

三次握手过程中，客户端和服务端的初始状态为CLOSE状态，当服务端启动服务开始监听端口，服务端进入Listen状态，开始接收TCP请求。

首先，第一次握手过程是客户端这边主动发送TCP报文请求建立连接，其中特殊位SYN置1，序列号为随机序列号，并进入SYN_SENT状态等待服务端回应ACK。

然后，第二次握手过程是服务端收到客户端发过来的TCP报文之后，会为其开辟缓存空间，接着回复TCP报文，其中特殊位SYN和ACK置1，序列号也为随机序列号，同时激活确认序列号，确认序列号为上一次TCP请求中所携带的客户端序列号+1，并进入到SYN_RCVD状态等待客户端回复ACK。

接着，第三次握手过程是客户端收到服务端回应的TCP报文后，向服务端回复TCP报文，其中特殊位ACK置1，激活确认序列号，确认序列号为上一次TCP回复中所携带的服务端序列号+1，并进入到ESTABLISHED状态，此时客户端单方面建立连接，所以该报文可以携带数据。

最后，服务端收到客户端回应的TCP报文，检查完确认序列号后进入到ESTABLISHED状态。至此，双方的TCP连接建立完成。

- **追问：为什么不能是二次握手？**

TCP连接是双向的，这意味着双方都需要确认自己发送数据的能力和对方接收数据的能力是正常的，同时还可以避免新旧报文之间产生的问题。

- **追问：为什么要设置随机序列号？**

首先是可以有效防止序列号预测攻击，若有规律的序列号会导致中间人伪装其报文进行信息窃取。其次能够解决新旧连接造成资源混乱的问题。	

- **追问：若服务端未进入listen状态，会如何处理TCP请求？**

在第一次握手中，服务端会直接发送特殊位RST置1的报文作为强制中断连接。

**（3）TCP的四次挥手过程？**

四次挥手过程中，客户端和服务的初始状态都为已建立连接的ESTABLISHED状态。

首先，客户端这边发送TCP报文请求断开连接，其中特殊位FIN置1，此时是可以携带最后剩余的数据，并进入到FIN_WAIT_1状态等待服务端回应。

然后，服务端收到客户端这边发送的TCP报文，向服务端回复TCP报文，其中特殊位ACK置1，并进入CLOSED_WAIT状态，客户端收到该报文后，进入到FIN_WAIT_2状态，此时断开了客户端向服务端单方面的连接，但服务端还是可以向客户端继续发送剩下的数据。

接着，服务端发送最后一段数据时，向客户端发送的TCP报文内，特殊位FIN置1，请求断开连接，并进入到LAST_ACK状态等待客户端的ACK回应。

最后，客户端收到服务端发送的TCP报文，向服务端回复TCP报文，其中特殊位ACK置1，并进入TIME_WAIT状态，等待2MSL后，才进入到CLOSE状态，服务端那边收到客户端回应的TCP报文后，就进入到CLOSE状态了，至此，两边TCP连接完全断开。

- **追问：2MSL是什么？为什么要经过2MSL时间？**

MSL是报文的最大存活时间。这样能够确保最后一个ACK报文丢失的情况下，能够等到对方重传，一来一回正好两个MSL时间。同时设置2MSL情况下，足以让两个方向上的TCP报文都消失，防止建立新的连接时，被旧的TCP报文所影响。

**（4）Http常见状态码以及含义？**

2开头为请求成功，其中201表示请求成功并创建了资源；204表示请求成功，但无返回内容。

3开头为请求重定向，其中301表示资源已经被永久移动到了新位置；302表示资源被临时移动到了新位置，304表示文件资源自从上次请求后就没有修改过。

4开头为客户端错误，其中400表示请求无效，包括参数、语法等错误；401表示未认证，需要登录和验证；403表示服务器拒绝请求，可能是权限问题；404表示请求的资源不存在。

5开头为服务端错误，其中500表示服务器内部错误；502表示网关或代理收到无效响应，可能是后端Server挂掉了；503表示服务器临时不可用，可能在维护状态；504表示请求网关或代理请求超时。

**（5）两台主机之间不通了，如何排查？**

我会参照OSI七层参考模型，自下而上的进行检查分析。

首先检查网线是否插好，查看网卡状态是否正常启用，IP地址有没有配置正确。其次查看arp表，观察是否学习到了对端的IP地址。接着查询路由表，检查子网掩码是否匹配，ping 本机网关以及对端IP是否能连通。然后检查端口，使用telnet能否连接到对端，以及在对端ss查看端口是否是监听状态。最后是检查防火墙的规则，有无放通或禁止策略。

具体情况根据可以通过分析哪一层不通，以此来检查它的上下一层。

**（6）可以ping通域名，但是访问不了服务如何排查？**

如果可以ping通的话，说明到达网络层是没有问题的，具体排查上面的传输层和应用层。

客户端方面可以通过curl -v查看返回的详细信息以及状态码，通过分析状态码来得出是客户端问题还是服务端问题，比如说400可能是请求参数或语法出问题、401表示未认证、403可能是权限问题拒绝访问、404表示请求的资源不存在，5开头就是服务器这边的问题。此外还可以通过telnet去检查服务器端口是否开放，或者直接使用ping通的ip进行访问，观察是否是DNS方面的问题，主要是浏览器DNS缓存这一块。

服务端方面可以通过ss -tulnp查看服务端口是否正在监听，服务状态是否正常，服务日志是否出现报错，以及防火墙是否有放通或堵塞流量的规则。

**（7）IPv4和IPv6的区别？**

ipv4是由32位二进制组成的，由点分十进制表示

ipv6是由128位二进制组成的，由冒号分十六进制表示。

**（8）VLAN有什么作用？**

vlan可以隔离广播域，一个vlan内的广播帧只会在整个vlan内传播。

**（9）DNS解析的过程？**

首先用户通过浏览器输入网址，浏览器会现查看浏览器的DNS缓存信息，若无缓存，则查看hosts文件内是否有本地解析，若无解析，则向本地DNS发起一次递归查询。接着若本地DNS也无解析信息，则先查询根域名缓存，若根域名信息过期或没有，再请求根服务器，根服务器会返回该域名的顶级域名服务器地址，本地DNS收到地址后，对顶级域名服务器发起解析请求，顶级域名服务器则继续返回二级域名服务器，依次类推最终找到解析该域名的服务器地址，这一段过程为迭代查询。

- **追问：递归查询和迭代查询分别是什么？**

递归查询就是仅发起一次请求，要求直接得到结果。而迭代查询则是，发起请求，收到返回的结果后，针对结果再次发送请求。

- **追问：DNS的端口为多少？**

DNS的端口号为53。

# 二、Linux系统

**（1）Linux常用的命令？**

首先是关于文件方面，主要有touch创建文件、mkdir创建目录、rm删除目录或文件、cp复制文件、mv移动或重命名文件，cd切换目录；查看文件的命令主要有ls查看目录下的文件或目录，find查找文件，cat查看文件内容、head查看头十行、tail查看尾十行、less交互式可翻页查看，而分析日志还可以通过管道符加上grep、awk、sed来对数据进行有效处理；然后是解压缩文件有tar、zip、unzip等命令。接着是系统方面，系统指标可以通过top、df、free分别查看cpu、磁盘、内存的使用情况，ps查看进程使用情况，ss查看端口使用情况。然后网络方面有ping、curl命令；用户方面有whoami、id、passwd等命令。上面就是比较常用的命令了。

**（2）文件系统了解多少？**

文件系统是操作系统用于存储数据的一套方法论，它定义了如何将数据存入磁盘，以及如何从磁盘中读取数据。

- 追问：inode是什么？

inode是linux文件系统中用于描述一个文件或目录的元数据的数据结构，主要包含文件大小、文件权限、文件所有者、文件属组、以及时间戳等信息。

**（3）忘记root密码了怎么办？**

重启服务器，在选择启动选项的时候，进入救援模式来重置root密码。

**（4）lvm是什么？**

LVM 是逻辑卷管理器，用于灵活管理磁盘空间。

**（5）文件被删除后，磁盘空间没有被释放，如何排查和解决？**

可能是文件被删除后，仍有进程在操作该文件，可以通过`lsof | grep deleted`去查看具体的服务和进程，可以通过重启服务或者杀死进程解决。

# 三、Shell脚本

**（1）单引号、双引号和不带引号的区别？**

单引号内所有的字符都会被看作普通字符，会原封不动的输出字符串，不会出现变量替换、命令替换和转移字符等操作。

双引号会保护大部分字符的原意，但允许变量替换、命令替换和转移字符等操作。

而不带引号可能会导致一些字符串分割问题。

**（2）如何逐行读取文件内容？**

通过while IFS= read -r line; do echo "$line"; done < a.txt命令。其中while用作循环、IFS=表示空的字符分隔符、read -r原始读取、line表示读取的每一行数据、< a.txt表示传入需要读取的文件。

# 四、Web 高可用集群

**（1）Nginx应用场景、以及其特点？**

首先nginx是一个高性能的http和反向代理服务器，主要的应用场景有：静态内容服务、反向代理、负载均衡、API网关等等。

主要的特点是高并发、高性能，同时内置丰富的模块功能。

**（2）Nginx的负载均衡算法？**

静态的有：轮询、加权轮询、ip哈希、随机；

动态的有：最小连接数、加权最小连接数、最短响应时间。

**（3）lvs有哪些算法？**

首先静态的算法有rr轮询调度，会依次分配给不同的RS；wrr加权轮询调度，按照权重依次分配给相应权值的RS；sh源地址哈希调度，将来自于同一个IP地址的请求始终发往第一次挑中的RS，从而实现会话绑定；dh目的哈希调度,第一次轮询调度至RS，后续将发往同一个目标地址的请求始终转发至第一次挑中的RS。（使用场景：运营商）。


接着，动态的算法有lc：最小连接数调度，按照最小连接数来转发；wlc加权最小连接数调度，按照权重+最小连接数来转发；SED最短期望的延迟，初始连接高权重优先，可以解决wlc的高权重饥饿问题；NQ最小队列调度，第一轮均匀分配，后续SED，可以解决SED低权重饥饿问题；lblc基于地址的最小连接数调度，动态的DH算法。使用场景：根据负载状态实现正向代理；lblcr带复制功能的LBLC，解决LBLC负载不均衡问题，从负载重的复制到负载轻的RS。


最后，新增三种有FO，在此FO算法中，遍历虚拟服务所关联的真实服务器链表，找到还未过载(未设置IP_VS_DEST_FOVERLOAD标志)的且权重最高的真实服务器，进行调度。（常用作灰度发布）；OVF在FO的基础上加一个权重，一个可用的真实服务器需要同时满足条件：未过载(未设置IP_VS_DEST_FOVERLOAD标志)、真实服务器当前的活动连接数量小于其权重值、其权重值不为零；MH：调度器预先生成”请求-资源映射表“，并按照表指派RS响应请求。

**（4）HAProxy是做什么用的？**

HAProxy主要是一种高可用集群方案，可以实现四层和七层的负载均衡，同时还可以通过健康检查实时检查后端server的情况。

**（5）keepalived是做什么用的？**

keepalived主要解决单点故障问题，维护集群的高可用，当一台调度器出现了故障，keepalived能够及时通过心跳检测出来，并进行故障转移，对于后端server，可以通过脚本实现健康检查。

- **追问：如何实现故障转移？**

故障转移主要通过VRRP协议来实现的，当keepalived正常工作时，主节点会不断向备用节点广播心跳信息，以表示自己是存活状态，当主节点发生故障时，备用就无法继续检测到主节点的心跳，进而调用自身的接管程序，接管主节点的IP资源和服务。当主机节点恢复时，备节点会主动释放原来的资源，继续回到备份的角色。

# 五、容器化

**（1）容器和虚拟机的区别？**

首先是它门的资源占用，虚拟机的镜像体积大，需要运行独立的操作系统，资源开销大；而容器的镜像体积小，共享的宿主机内核的进程，资源开销低。

其次是它们的隔离性，虚拟机属于完全隔离，其中一台主机崩溃并不会影响另外一台，安全性高；而容器属于进程级别的隔离，共享内核，隔离性相对较弱。

最后是它们的部署速度，虚拟机启动需要引导整个操作系统，部署慢；而容器本质是启动一个进程，速度快。

**（2）Docker容器之间是如何进行隔离的？**

主要依赖于namespace、cgroup、union file system。

其中namespace负责环境视图的隔离、cgroup负责物理资源的隔离、联合文件系统负责文件系统的隔离。

**（3）Dockerfile的结构是什么样的？**

首先通过FROM使用一个原始镜像进行构建，LABEL表示镜像的作者和联系方式，ARG和ENV分别声明构建时的变量和容器运行后的变量、WORKDIR定义的工作目录、COPY、ADD和RUN分别代表复制文件和运行命令，其中ADD相较于COPY的功能更强大，支持远程URL和文件自动解压，再者就是根据需求暴露端口通过EXPOSE、健康检查通过HEALTHCHECK、设置容器入口通过CMD或ENTRYPOINT,其中CMD可以被覆盖而ENTRYPOINT不可覆盖，只可以添加启动参数。

**（4）对比 Docker 和 Kubernetes，K8s 管理的优势是什么？**

首先是自动修复，如果某个pod运行失败，k8s会尝试自动重启，若节点故障，会尝试在其它健康节点启动。

然后是负载均衡，k8s可以为一组容器提供一个service，从而实现负载均衡。

接着还可以自动发布和版本回退，可以通过金丝雀进行灰度发布，以及出现故障时可以回滚版本。

最后是声明式API，只需要一个YAML文件，k8s就可以按照你期望的状态持续工作，减少手动运维。

**（5）Pod有什么特点？**

pod是k8s中最小调度和部署，其中包含一个或多个容器，其生命周期是短暂的，IP在重建后会发生变化。

**（6）Pod的生命周期？**

首先pod的阶段有：pending调度和拉取镜像、running运行中状态、successded或failed最终状态。

主要通过探针以及重启策略来管理应用的健康状态。

**（7）Pod的指针有哪些？**

存活指针、就绪指针、启动指针。

其中存活指针：判断容器是否正在运行，若存活指针探测失败，会立刻重置容器，根据重启策略来判断是否重启容器。

就绪指针：判断容器是否准备好接收服务，若就绪指针探测失败，会将pod从匹配的service中移除。

启动指针：判断容器中的应用是否启动成功，优先级比前面两个指针要高，若探测失败，会重置容器，受重启策略影响。

**（8）k8s的组件有哪些？**

控制平面有：kube-apiserver是k8s集群的唯一入口、etcd是所使用到的数据库、kube-scheduler负责pod的调度、kube-controller-manager运行着一系列控制器的守护进程。

工作节点有：kubelet相当于节点上的代理，向apiserver汇报本节点的状态、kube-proxy维护节点上的网络规则、CRI容器运行时，负责真正运行容器。

**（9）k8s默认的命名空间有哪些？**

default、kube-system、kube-public。

**（10）Deployment和StatefulSet有什么区别？**

deployment用于无状态应用，其pod是可呼唤的，共享存储；而statefulset适用于有状态应用，它为每一个pod提供稳定的网络标识，独立的持久化存储，在数据库的主从同步中就会运用到它。

# 六、监控告警、日志分析系统

**（1）数据采集中，主动拉取和被动拉取有什么特点？**

主动拉取是由控制器定时主动去受采集节点去拉取数据。而被动拉取是受采集节点有事件触发时，去给控制节点发送数据。

# 七、自动化运维

**（1）ansible介绍一下？**

ansible是一款自动化运维工具，基于python开发的，主要有主机清单、playbook、以及丰富的模块和插件组成。其中最大的特点是无需代理，核心是通过ssh去连接受管主机；同时它的特点还有跨平台支持，对于linux、windows、包括一些网络设备的支持、人类可读的yaml格式的配置、以及playbook执行的过程都有完美的记录，同时大部分模块都是幂等性的。

- **追问：它的幂等性是什么？**

幂等性是指无论执行多少次任务，最终状态都是一致的，并不会产生其它副作用。

# 八、数据库

**（1）mysql数据库备份还原所用的工具和命令？**

通过mysqldump指定备份的数据库，生成一个.sql文件，之后通过mysql去导入该文件。

- **追问：备份还原数据库过程，如何确保数据的一致性？**

首先，在备份过程中，必须保证备份文件中的数据是某个时间点的一致快照，可以使用 `--single-transaction` 参数确保备份数据在逻辑上的一致性。

然后，在还原后可以通过CHECK TABLE验证表结构完整性，抽样查看一些表的数据，也可以对比二进制日志。

**（2）mysql的主从同步配置过程？**

首先主库、从库都需要配置唯一的server_id，然后可以选择开启gitd，通过gtid进行同步。接着主库上创建用于复制的用户并赋予权限。从库上进行指定主库的IP、用户和密码的操作，之后开启同步模式，通过show slave status查看是否配置成功。

**（3）如何排查和解决慢 sql 查询问题？**

首先开启慢查询日志，找到对应的慢sql，在其前面加上`EXPLAIN`去分析执行计划，根据得出的数据做出相应的解决措施，比如添加索引、优化表结构、优化sql查询语句。

**（4）Redis缓存如果遇到大面积的查询，会出现什么问题？**

可能会导致缓存雪崩、缓存击穿、缓存穿透问题。

# 九、Python

**（1）多进程、多线程和协程的区别是什么？**

多进程是系统资源调度的单位，开销大、隔离性好；

多线程是CPU调度的单位，开销小、共享内存；

协程是用户态调度的，极度轻量，为高并发I/O设计的。

- **追问：用户态和系统内核态有什么区别？**

用户态是低权限级别，只能访问自己的内存空间，无法直接访问硬件资源；而系统内核态是高权限级别，可以访问所有的内存空间和硬件资源。

# 十、主观题

**（1）原本是大数据专业，为什么想转运维？**

在我大数据专业的学习和项目实践中，我逐渐发现自己的兴趣点更偏向于构建和维护稳定的基础架构。相比于在数据之上进行复杂的算法挖掘，我更能从保障系统的稳定运行中获得成就感。我非常认同这种靠解决实际问题来驱动技术成长的发展模式，它能让我的经验持续沉淀和自身价值的增长。

**（2）你认为的运维是干什么的？**

首先是最基础的监控告警，建立全方位的监控系统，对应用、服务器、网络等等关键指标进行实时监控，出现问题第一时间解决。然后是故障排查，当线上出现故障时，需要快速定位到问题的根源并协调解决。接着是实现高可用和容灾，设计集群架构，避免单点故障的影响，以及异地容灾的机制，总的来说就是对于业务的一个保障性。此外还要有提升效率的能力，比如说自动化运维、CI/CD、平台化建设，以及资源的优化和减少成本。

**（3）为什么说自己抗压能力强？**

首先是我刚刚提到过的，我情绪稳定，在受到压力产生的负面影响下，我的第一反应不是焦虑和抱怨，而是专注下一把该做什么、怎么做，将压力转换为解决问题的动力。其次，我能够接受批评，尤其是一些能够帮助到我的批评。因此我的抗压能力强主要是来自于我的情绪稳定和积极的成长观念锻炼出来的。







1、现要备份30TB的数据库信息，目前有10块4TB的磁盘，有哪些磁盘阵列方案

浩迹智能面经：

1、上家公司有用到k8s集群吗，k8s有什么特点？

2、pod的生命周期，如何探测？具体说一下存活指针？

3、文件系统了解多少，inode是什么？

4、拷打项目，如何实现高可用的？如何理解高可用？

5、负载均衡有什么算法？灰度发布是怎么进行的？

6、如何保持热更新？

7、有状态应用的更新？

8、mysql了解多少？如何排查慢 sql 查询？

9、计网了解多少？可以ping通域名，但是访问不了如何排查？具体解决命令？

10、TCP协议介绍一下？为什么是三次握手，而不是二次握手？

11、现CPU满了，用户反馈过来要求立马解决，如何排查？占用资源的是主进程，如何优化？

12、进程和线程分别是什么？协程有了解吗？用户态和系统内核态有什么区别？

13、Redis集群过程出现问题，自身会做出什么反应？

14、Redis缓存如果遇到大面积的查询，会出现什么问题？

15、有了解过AI大模型吗，具体说一下？

1、prometheus如何监控容器



